<!--Exercise Section-->


<table style="border-spacing: 0px;border-collapse: collapse;font-family:serif">
<tr>
<td width=25% style="vertical-align:middle;background-color:darkorange;border: 2px solid darkorange">
<i class="fa fa-cogs fa-lg fa-pull-left fa-fw" style="color:white;padding-right: 12px;vertical-align:text-top"></i>
<span style="color:white;font-size:x-large;font-weight: bold">Exercise 3</span>
</td>
<td style="border: 2px solid darkorange;background-color:darkorange;color:white">
<span style="color:white;font-size:x-large;font-weight: bold">Noise Control Laws Project (Spatial Filtering)</span>
</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Data</td>
<td style="border: 1px solid darkorange">Addresses (File Geodatabase)<br>Zoning (MapInfo TAB)<br>Roads (AutoCAD DWG)</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Overall Goal</td>
<td style="border: 1px solid darkorange">To find all residential addresses within 50 meters of an arterial highway</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Demonstrates</td>
<td style="border: 1px solid darkorange">Methods of conditional filtering</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">Start Workspace</td>
<td style="border: 1px solid darkorange">C:\FMEData2019\Workspaces\DesktopBasic\Transformers-Ex3-Begin.fmw</td>
</tr>

<tr>
<td style="border: 1px solid darkorange; font-weight: bold">End Workspace</td>
<td style="border: 1px solid darkorange">C:\FMEData2019\Workspaces\DesktopBasic\Transformers-Ex3-Complete.fmw</td>
</tr>

</table>

As you know, city councillors have voted to amend noise control laws and residents living in affected areas must be informed of these changes.

You have been recommended by your manager to take on the task, and there's a tight deadline.

In the first part of the project, you created a workspace to convert addresses from Geodatabase to Excel, mapping the schema at the same time.

This exercise is the second part of the project: locating all affected residents. You must locate all single-family residences within 50 meters of a major highway and filter out all others from the stream of address data.


<br>**1) Start FME Workbench**
<br>Start FME Workbench (if necessary) and open the workspace from Exercise 2. Alternatively you can open C:\FMEData2019\Workspaces\DesktopBasic\Transformers-Ex3-Begin.fmw

![](./Images/Img4.218.Ex3.StartingWorkspace.png)

The workspace already has a FeatureReader to read addresses, transformers to edit the address schema, and a writer to write data to an Excel spreadsheet.


<br>**2) Add Roads Data Reader**
<br>Use Readers &gt; Add Reader to add a reader for the roads data. The roads data will be used to the determine distance from an arterial route.

<table style="border: 0px">

<tr>
<td style="font-weight: bold">Reader Format</td>
<td style="">Autodesk AutoCAD DWG/DXF</td>
</tr>

<tr>
<td style="font-weight: bold">Reader Dataset</td>
<td style="">C:\FMEData2019\Data\Transportation\CompleteRoads.dwg</td>
</tr>

</table>

When prompted, select only the feature type called Arterial.


<br>**3) Add Zoning Data Reader**
<br>Use Readers &gt; Add Reader to add a reader for zoning data. The zoning data will be used to determine whether an address is single-family residential or not.

<table style="border: 0px">

<tr>
<td style="font-weight: bold">Reader Format</td>
<td style="">MapInfo TAB (MITAB)</td>
</tr>

<tr>
<td style="font-weight: bold">Reader Dataset</td>
<td style="">C:\FMEData2019\Data\Zoning\Zones.tab</td>
</tr>

</table>

With attribute lists collapsed, the workspace will now look like this:

![](./Images/Img4.219.Ex3.NewReaders.png)

Feel free to inspect all of the source data to familiarize yourself with the contents. You can even run the workspace to make sure all caches are up to date.


<br>**4) Add a Tester Transformer**
<br>Add a Tester transformer to the Zoning feature type.

This Tester will be used to filter residential zones from the other zoning areas.
All single-family residential zones will start with RS, so the Tester should be set up like this:

![](./Images/Img4.220.Ex3.TesterParameters.png)

The important thing is to set up the test with the “Begins With” operator.

<br>**5) Connect Tester to the FeatureReader**
<br>One way to filter data is to use a SpatialFilter transformer, and we will do this with the road features. But another method is to use filtering inside the FeatureReader transformer.

So, delete the Creator transformer and connect the Tester:Passed port to the FeatureReader:Initiator port:

![](./Images/Img4.221.Ex3.TesterReplacesCreator.png)


<br>**6) Set up the FeatureReader**
<br>Now inspect the FeatureReader's parameters. Set the Spatial Filter parameter to *Initiator Contains Result:*

![](./Images/Img4.222.Ex3.FilteredFeatureReader.png)

This ensures that only addresses that fall inside a Single Family Residence zone will be read from the database. Make sure feature caching is turned on and run the workspace to the FeatureReader. Inspect the Tester:Passed and FeatureReader:PostalAddress caches to confirm that the results are correct.

For the Tester, there should be 19 features coming from the Tester:Passed output port. The FeatureReader:PostalAddress output port will now only have 1853 features, compared to the 13597 features before we filtered by zone.


<br>**7) Add a Bufferer Transformer**
<br>Now we can determine which of the filtered addresses fall within 50 meters of an arterial route. First, we will need to add a Bufferer transformer to set the 50-meter distance around the roads.

 Add a Bufferer transformer to the workspace. Connect it to the Arterial roads data:

![](./Images/Img4.223.Ex3.BuffererOnCanvas.png)

Set the Bufferer Buffer Amount parameter to be 50.

---

<!--Updated Section--> 

<table style="border-spacing: 0px">
<tr>
<td style="vertical-align:middle;background-color:darkorange;border: 2px solid darkorange">
<i class="fa fa-bolt fa-lg fa-pull-left fa-fw" style="color:white;padding-right: 12px;vertical-align:text-top"></i>
<span style="color:white;font-size:x-large;font-weight: bold;font-family:serif">2019.1 UPDATE</span>
</td>
</tr>

<tr>
<td style="border: 1px solid darkorange">
<span style="font-family:serif; font-style:italic; font-size:larger">
A common question with the Bufferer is what units the buffer amount uses. In general it's the coordinate system (ground) units, but in 2019.1 the Bufferer has a new parameter called <strong>Buffer Distance Units</strong>: 
<br><br><img src="./Images/Img4.223b.Ex3.BuffererUnits.png">
<br><br>This parameter allows you to set (for example) units in feet, while retaining the data in its original coordinate system (maybe latitude/longitude where the units are decimal degrees).
<br><br>As long as you have FME2019.1.0.1 (build 19610 or greater - there was a minor bug in the 2019.1 release build) for this exercise the parameter can be either Ground Units or Meters (metres), as meters are both the ground units and the required buffer amount. If you wish, try changing the units to Feet and setting the buffer size to 164. The results should be virtually identical.
<br><br>Another parameter you may wish to set here is <strong>Dissolve on Attributes</strong>. This is a group-by style of parameter that causes all buffered features to be dissolved together based on an attribute value. It's a way to give a tidier output, while still covering the same geographic area. In this case you could use the fme_feature_type attribute.
</span>
</td>
</tr>
</table>

---

<br>**8) Add a SpatialFilter Transformer**
<br>Add a SpatialFilter transformer. The buffered arterial routes are the Filter. The Candidate port can be connected between the FeatureReader and the AttributeSplitter:

![](./Images/Img4.224.Ex3.SpatialFilterOnCanvas.png)

This way the AttributeSplitter and AttributeManager are operating only on filtered features. If the SpatialFilter was connected after the AttributeManager, then data would be getting processed and then discarded.


<br>**9) Set SpatialFilter Parameters**
<br>Set up the SpatialFilter parameters as follows:

<table>
<tr><td style="font-weight: bold">Filter Type</td><td>Multiple Filters</td><td>There are multiple buffer polygons</td></tr>
<tr><td style="font-weight: bold">Pass Criteria</td><td>Pass Against One Filter</td><td>A single address cannot be in <strong>all</strong> buffers</td></tr>
<tr><td style="font-weight: bold">Spatial Predicates to Test</td><td>Filter Contains Candidate</td><td>Find addresses contained in the arterial buffers</td></tr>
</table>

![](./Images/Img4.225.Ex3.SpatialFilterParameters.png)

That is, there are multiple road buffers, but an address only has to be inside one buffer to pass, not all of them.


**10) Run the Workspace**
<br>Run the workspace by pressing <kbd>F5</kbd> and check the output to confirm the dataset has been written correctly. There should be 148 records in the spreadsheet, ready to send to the administration department for a bulk mailing.

If you have more than 148 rows in the final spreadsheet, remember to set the Excel Writer parameters to Overwrite Existing File to Yes.

---

<!--Exercise Congratulations Section-->

<table style="border-spacing: 0px">
<tr>
<td style="vertical-align:middle;background-color:darkorange;border: 2px solid darkorange">
<i class="fa fa-thumbs-o-up fa-lg fa-pull-left fa-fw" style="color:white;padding-right: 12px;vertical-align:text-top"></i>
<span style="color:white;font-size:x-large;font-weight: bold;font-family:serif">CONGRATULATIONS</span>
</td>
</tr>

<tr>
<td style="border: 1px solid darkorange">
<span style="font-family:serif; font-style:italic; font-size:larger">
By completing this exercise you have learned how to:
<br>
<ul><li>Use the Tester transformer to filter by an attribute value</li>
<li>Use the Spatial Filter option in the FeatureReader transformer</li>
<li>Use the Bufferer transformer to set up a "within x distance of" test</li>
<li>Use the SpatialFilter transformer to filter by geometry</li></ul>
</span>
</td>
</tr>
</table>
