  <div id="readme" class="readme blob instapaper_body">
    <article class="markdown-body entry-content" itemprop="text"><table>
<tbody><tr>
<td width="25%">
<i></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
练习8 
</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在工作空间练习中使用REST API命令
</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总体目标</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在工作空间中使用REST API </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何使用HTTPCaller访问FME Server</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动工作空间</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无</font></font></td>
</tr>
<tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束工作空间</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\FMEData2018\Resources\RESTAPI\Chapter4Exercise8\Chapter4Exercise8.Complete.fmw
</font></font></td>
</tr>
</tbody></table>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以创建一个非常简单的工作空间，它可以触发FME Server中的多个工作空间。</font><font style="vertical-align: inherit;">在这个工作空间中，我们将逐步增加一个工作空间来异步运行，等待响应，如果响应是肯定的，则下一个工作空间将运行。</font><font style="vertical-align: inherit;">那么让我们开始吧！</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.1.1stStep.png"><img src="./Images/image4.6.1.1stStep.png" alt="" style="max-width:100%;"></a></p>
<p><br><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个异步运行的调用</font></font></em></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1）在Workbench中创建一个新工作空间，并将一个Creator转换器添加到画布</font></font></strong> <br></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开一个新的FME工作空间，然后将Creator转换器添加到画布。</font><font style="vertical-align: inherit;">保持默认设置是可以的。</font><font style="vertical-align: inherit;">Creator创建一个启动HTTPCaller的单一要素。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2）将HTTPCaller添加到画布</font></font></strong> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
接下来，添加HTTPCaller。</font><font style="vertical-align: inherit;">使用请求URL编写提交命令。</font><font style="vertical-align: inherit;">您可以使用下面的调用，或者使用另一个工作空间测试它。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在HTTPCaller中使用FME Server进行授权有几种不同的方法：</font></font></p>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用URL中的令牌作为查询字符串参数</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在授权标头中使用令牌</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">勾选使用身份验证并设置为基本身份验证并输入您的用户名和密码</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">勾选使用身份验证并设置FME Server Web连接</font></font></li>
</ol>
<hr>

<table>
<tbody><tr>
<td>
<i></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
注意
</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

在课程开始时，我们讨论了身份验证和授权之间的区别。</font><font style="vertical-align: inherit;">这是指从FME Server发送的响应代码。</font><font style="vertical-align: inherit;">身份验证错误和授权错误之间存在差异。</font><font style="vertical-align: inherit;">但是，在HTTPCaller中，对调用进行身份验证或授权可以互换使用。  

</font></font></td>
</tr>
</tbody></table>
<hr>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，本节中的所有调用都需要授权。</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要填写的HTTPCaller中的第一部分是请求和标头。</font><font style="vertical-align: inherit;">HTTPCaller中的布局非常简单，因为要填充的所有区域都有清晰的令牌。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，这是一个示例调用，可以在</font></font><a href="https://docs.safe.com/fme/html/FME_REST/apidoc/v3/index.html#!/transformations/submit_post_22" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rest API POST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档中找到。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，粘贴请求URL。然后，将HTTP方法更改为Post。</font><font style="vertical-align: inherit;">更新标头。</font></font></p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

&lt;style type =“text / css”&gt; .tg {border-collapse：collapse; border-spacing：0;} .tg td {font-family：Arial，sans-serif; font-size：14px; padding：10px 5px ; border-style：solid; border-width：1px; overflow：hidden; word-break：normal; border-color：black;} .tg th {font-family：Arial，sans-serif; font-size：14px; font-weight：normal; padding：10px 5px; border-style：solid; border-width：1px; overflow：hidden; word-break：normal; border-color：black;} .tg .tg-ao4k {background-color ：＃e6ffe6;颜色：＃333333; vertical-align：top} .tg .tg-a080 {background-color：＃e6ffe6; vertical-align：top} &lt;/ style&gt;
</font></font><table>
  <tbody><tr>
    <th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POST</font></font></th>
    <th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP：// &lt;yourServerHost&gt; /fmerest/v3/transformations/submit/Samples/austinDownload.fmw</font></font></th>
  </tr>
</tbody></table>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标头：</font></font></strong></p>
<ul>
<li>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accept：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> application / json</font></font></p>
</li>
<li>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Authorization：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fmetoken token = &lt;yourToken&gt;</font></font></p>
</li>
</ul>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.2.Header.png"><img src="./Images/image4.6.2.Header.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当您插入调用的主体部分时，请找到</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上传</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主体</font><font style="vertical-align: inherit;">并单击下拉菜单。</font><font style="vertical-align: inherit;">单击“打开文本编辑器”并将“上传主体”粘贴到调用中。</font></font></p>
<pre><code>{<font></font>
  "publishedParameters": [<font></font>
    {<font></font>
      "name": "MAXY",<font></font>
      "value": "42"<font></font>
    },<font></font>
    {<font></font>
      "name": "THEMES",<font></font>
      "value": [<font></font>
        "airports",<font></font>
        "cenart"<font></font>
      ]<font></font>
    }<font></font>
  ]<font></font>
}<font></font>
</code></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，找到</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Content Type</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分并指定JSON（application / json）。</font><font style="vertical-align: inherit;">主体看起来像这样：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.3.UploadBody.png"><img src="./Images/image4.6.3.UploadBody.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3）检查HTTPCaller的输出</font></font></strong></p>
<table>
<tbody><tr>
<td>
<i></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FME Workbench 2018的新变化
</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

在本练习中，我们使用了要素缓存。</font><font style="vertical-align: inherit;">要素缓存是一种工具，允许用户在运行后检查工作空间中每个转换器的输出。</font><font style="vertical-align: inherit;">它还允许部分运行工作空间。</font><font style="vertical-align: inherit;">这意味着您不必从工作空间的开头开始并运行到最后。</font><font style="vertical-align: inherit;">您可以选择运行开始和结束的位置。</font><font style="vertical-align: inherit;">有关要素缓存的更多信息，请阅读</font><a href="https://blog.safe.com/2018/05/caching-data-fme-evangelist174/" rel="nofollow"><font style="vertical-align: inherit;">要素缓存</font></a><font style="vertical-align: inherit;">上的Safe博客文章</font></font><a href="https://blog.safe.com/2018/05/caching-data-fme-evangelist174/" rel="nofollow"><font style="vertical-align: inherit;"></font></a>

</td>
</tr>
</tbody></table>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将Logger转换器连接到HTTPCaller上的Output端口，并在启用了要素缓存的情况下运行工作空间。</font><font style="vertical-align: inherit;">为此，请单击顶部工具栏中的“运行”，然后选择“使用要素缓存运行”。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.4.RunwithFeatureCaching.png"><img src="./Images/image4.6.4.RunwithFeatureCaching.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Logger将写入保存工作空间的文本文件，并写入FME Workbench底部的转换日志。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日志文件包括响应主体和响应代码。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.5.Logfile.png"><img src="./Images/image4.6.5.Logfile.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于响应主体，我们只想公开id值，但忽略JSON格式。</font><font style="vertical-align: inherit;">因此，我们使用JSON Flattener。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在继续下一步之前，请删除Logger。</font></font></p>
<hr>
<table>
<tbody><tr>
<td>
<i></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ricky RESTless说......
</font></font></td>
</tr>
<tr>
<td>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然FME Server REST API不限制您可以进行的调用数量。</font><font style="vertical-align: inherit;">其他API可能会限制您可以免费进行的调用数量。</font><font style="vertical-align: inherit;">在这种情况下，要素缓存是一个非常方便的工具。</font><font style="vertical-align: inherit;">您可以检查输出并调整工作空间，而无需对服务器进行其他调用。</font></font></p>

</td>
</tr>
</tbody></table>
<hr>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4）将JSONFlattener添加到画布</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在您可以添加JSONFlattener。</font><font style="vertical-align: inherit;">JSONFlattener允许您选择要暴露的JSON的一部分，在我们的示例中，我们应该暴露id，因此我们可以将它用于下一次调用。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数应如下所示：</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON文档(JSON Document)：</font></font></strong> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_response_body</font></font></em></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">递归展平对象/数组(Recursively Flatten Objects/Arrays)：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要暴露的属性(Attributes to Expose)：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> id</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON解析错误的列表属性(List Attribute for JSON Parsing Errors)：</font></font></strong> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_json_error</font></font></em></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.5.JSONFlattener.png"><img src="./Images/image4.6.5.JSONFlattener.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5）选择JSONFlattener并单击Run To This(运行至此)</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们想要检查JSONFlattener并确保它只生成一个Job ID的属性。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.6.RunThis.png"><img src="./Images/image4.6.6.RunThis.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们返回工作空间，我们可以选择Data Inspector符号来检查输出。
</font></font><br>
<a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.7.Inspect.png"><img src="./Images/image4.6.7.Inspect.png" alt="" style="max-width:100%;"></a></p>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单击放大镜查看结果</font></font></em></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.8.jobid.png"><img src="./Images/image4.6.8.jobid.png" alt="" style="max-width:100%;"></a></p>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，我们可以看到新属性已成功创建</font></font></em></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取工作状态概观</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标是在下一部分是向服务器发送一个调用以检查先前的作业是否成功。</font><font style="vertical-align: inherit;">如果调用成功，那么我们可以运行一个新作业。</font><font style="vertical-align: inherit;">但是，此工作空间运行速度非常快，以至于FME Server在进行新调用之前没有时间处理上一个作业。</font><font style="vertical-align: inherit;">因此，在本节中，我们将创建一个自定义转换器，它将持续获取作业状态，直到作业完成。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6）添加HTTPCaller</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将添加一个</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPCaller</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将其附加到JSONFlattener。</font><font style="vertical-align: inherit;">最简单的方法是复制原始HTTPCaller，然后修改参数。</font><font style="vertical-align: inherit;">在HTTPCaller中，单击“Request URL”旁边的下拉菜单，然后单击“打开文本编辑器”。</font><font style="vertical-align: inherit;">粘贴请求，对于id，双击FME特性属性侧面板上的这个图标</font><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.7a.png"><img src="./Images/image4.6.7a.png" alt="" style="max-width:100%;"></a><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您的调用应该是这样的：</font></p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

&lt;style type =“text / css”&gt; .tg {border-collapse：collapse; border-spacing：0;} .tg td {font-family：Arial，sans-serif; font-size：14px; padding：10px 5px ; border-style：solid; border-width：1px; overflow：hidden; word-break：normal; border-color：black;} .tg th {font-family：Arial，sans-serif; font-size：14px; font-weight：normal; padding：10px 5px; border-style：solid; border-width：1px; overflow：hidden; word-break：normal; border-color：black;} .tg .tg-ej3l {background-color ：＃66ccff; vertical-align：top} .tg .tg-ufe5 {background-color：＃66ccff; vertical-align：top} &lt;/ style&gt;
</font></font><table>
  <tbody><tr>
    <th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GET</font></font></th>
    <th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://<yourServerHost>/fmerest/v3/transformations/jobs/id/@Value(id)</font></font></th>
  </tr>
</tbody></table>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标头：</font></font></strong></p>
<ul>
<li>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accept：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> application / json</font></font></p>
</li>
<li>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Authorization：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fmetoken token = &lt;yourSeverHost&gt;</font></font></p>
</li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，对于HTTPCaller中的响应，我们将把响应主体属性更改为job_status。</font><font style="vertical-align: inherit;">所以你的HTTPCaller应该是这样的：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.8.HTTPCallerParam.png"><img src="./Images/image4.6.8.HTTPCallerParam.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7）检查HTTPCaller的输出</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，右键单击HTTPCaller_2并选择Run to This。</font><font style="vertical-align: inherit;">从这里我们可以点击放大镜在FME Data Inspector中查看响应。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.9.Pulled.png"><img src="./Images/image4.6.9.Pulled.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从上图中可以看出，原始形式的响应非常长。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，最后，我们可以看到状态。</font><font style="vertical-align: inherit;">在这里你应该看到"status":"PULLED"。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所以知道我们需要提取响应的那一部分来测试调用是否成功。</font><font style="vertical-align: inherit;">为此，我们需要另一个JSONFlattener。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8）添加JSONFlattener</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回到FME Workbench，添加另一个JSONFlattener。</font><font style="vertical-align: inherit;">那么，对于JSON Document下的输入参数，我们将选择job_status。</font><font style="vertical-align: inherit;">然后在attributes to expose（要暴露的属性）下输入status。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.10.JSONFlatParams.png"><img src="./Images/image4.6.10.JSONFlatParams.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9）添加一个Tester</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们将添加一个</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tester</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来确定工作空间是否被拉动(PULLED)或运行。</font><font style="vertical-align: inherit;">如果状态为“PULLED”，则作业尚未运行。</font><font style="vertical-align: inherit;">因此，对于要完成的作业，状态不能等于PULLED。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tester应该命名为Tester_JobNotPulled。</font><font style="vertical-align: inherit;">通过更改转换器的名称，它允许用户快速了解Tester正在测试的内容。</font></font></p>
<ul>
<li>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左测值</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该是属性值状态。</font></font></p>
</li>
<li>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是！=。</font><font style="vertical-align: inherit;">这意味着不相等。</font></font></p>
</li>
<li>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">右侧值</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为PULLED。</font></font></p>
</li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tester正在测试作业状态是否不是pulled。</font><font style="vertical-align: inherit;">如果是pulled，它将被发送到Failed端口。</font><font style="vertical-align: inherit;">如果不是pulled它将进入Passed端口。</font></font></p>
<p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tester应该像这样设置：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.11.TesterJobNotPulled.png"><img src="./Images/image4.6.11.TesterJobNotPulled.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果状态为PULLED，则作业尚未运行，我们需要重新运行该调用以检查状态。</font><font style="vertical-align: inherit;">为此，我们需要使用looper制作自定义转换器。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10）创建自定义转换器</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择HTTPCaller_2，JSONFlattener_2和JobNotPulled，右键单击并选择Create Custom Transformer（创建自定义转换器）。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.12.CustomTransformers.png"><img src="./Images/image4.6.12.CustomTransformers.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入以下详细信息：</font></font></p>
<ul>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> JobStatusTester</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类别：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web</font></font></li>
<li><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概述：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此转换器将继续检查作业是否已从PULLED阶段传递。</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单击确定。</font><font style="vertical-align: inherit;">自定义转换器应如下所示：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.13.JobStatusTester.png"><img src="./Images/image4.6.13.JobStatusTester.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11）添加一个Looper转换器</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">右键单击工作空间，然后选择“插入转换器循环”。</font><font style="vertical-align: inherit;">您将收到一个对话框，其中显示：选择要循环到的输入。</font><font style="vertical-align: inherit;">默认值为Loop to：HTTPCaller_2_Input。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这意味着将循环HTTPCaller_2，它将再次检查作业ID。</font><font style="vertical-align: inherit;">将此循环连接到JobNotPulled的failed输出。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行工作空间！</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.14.CustomOverview.png"><img src="./Images/image4.6.14.CustomOverview.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们运行了工作空间，我们应该看到这样的东西：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.15.CustomRun.png"><img src="./Images/image4.6.15.CustomRun.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定制转换器在通过最后一个测试仪之前要运行57次。</font><font style="vertical-align: inherit;">但是，总的转换只有3.8秒。</font></font></p>

<table>
<tbody><tr>
<td>
<i></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
技巧
</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

这个循环正在尽可能快地在FME Server上签入。</font><font style="vertical-align: inherit;">虽然转换器运行了57次，如果这是一个较慢的作业，它可能会数千次击中FME Server。</font><font style="vertical-align: inherit;">这是Decelerator（减速器）可以派上用场的地方。</font><font style="vertical-align: inherit;">Decelerator会降低自定义转换器的速度，因此它可以减少对FME Server的调用。

</font></font></td>
</tr>
</tbody></table>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12）将输出添加到自定义转换器。</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">右键单击并选择“插入转换器输出”并将其连接到Tester_JobNotPulled的passed端口。</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们可以切换回主画布。</font></font></em></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13）添加测试仪</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们要添加一个</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tester</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来确定工作空间是否成功运行。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试程序应命名为Tester_Successfully_Run。</font><font style="vertical-align: inherit;">通过更改转换器的名称，它允许用户快速了解Tester正在测试的内容。</font></font></p>
<ul>
<li>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左侧值</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该是属性值状态。</font></font></p>
</li>
<li>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是=。</font></font></p>
</li>
<li>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">右侧值</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是SUCCESS。</font></font></p>
</li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是测试作业的状态是否等于success(成功)。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tester(测试仪)应该像这样设置：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.16.SuccessTester.png"><img src="./Images/image4.6.16.SuccessTester.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果状态为SUCCESS，则作业在FME Server上成功运行，并且将触发下一个工作空间。</font></font></p>
<p><em><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新作业开始运行</font></font></strong></em></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14）添加另一个HTTPCaller</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，使用第三个HTTPCaller同步运行新作业。</font><font style="vertical-align: inherit;">要执行此操作，请使用我们之前使用的相同调用，这是Transact调用。</font></font></p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

&lt;style type =“text / css”&gt; .tg {border-collapse：collapse; border-spacing：0;} .tg td {font-family：Arial，sans-serif; font-size：14px; padding：10px 5px ; border-style：solid; border-width：1px; overflow：hidden; word-break：normal; border-color：black;} .tg th {font-family：Arial，sans-serif; font-size：14px; font-weight：normal; padding：10px 5px; border-style：solid; border-width：1px; overflow：hidden; word-break：normal; border-color：black;} .tg .tg-ao4k {background-color ：＃e6ffe6;颜色：＃333333; vertical-align：top} .tg .tg-a080 {background-color：＃e6ffe6; vertical-align：top} &lt;/ style&gt;
</font></font><table>
  <tbody><tr>
    <th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POST</font></font></th>
    <th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP：// &lt;yourServerHost&gt; /fmerest/v3/transformations/transact/Samples/austinDownload.fmw</font></font></th>
  </tr>
</tbody></table>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标头：</font></font></strong></p>
<ul>
<li>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Content-Type：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> application / json</font></font></p>
</li>
<li>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accept：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> application / json</font></font></p>
</li>
<li>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Authorization：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fmetoken token = &lt;yourServerHost&gt;</font></font></p>
</li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主体：</font></font></p>
<pre><code>  {<font></font>
    "publishedParameters": [<font></font>
      {<font></font>
        "name": "MAXY",<font></font>
        "value": "42"<font></font>
      },<font></font>
      {<font></font>
        "name": "THEMES",<font></font>
        "value": [<font></font>
          "airports",<font></font>
          "cenart"<font></font>
        ]<font></font>
      }<font></font>
    ]<font></font>
  }<font></font>
</code></pre>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.16.FinalHttp.png"><img src="./Images/image4.6.16.FinalHttp.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这不是最实用的示例，因为我们运行相同的工作空间两次，但是以两种不同的方式，它演示了如何使用FME。</font><font style="vertical-align: inherit;">它演示了运行一个工作空间和使用响应来确定下一个操作的要素。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最终工作空间应如下所示：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image4.6.17.FinalWorkspace.png"><img src="./Images/image4.6.17.FinalWorkspace.png" alt="" style="max-width:100%;"></a></p>
<hr>

<table>
<tbody><tr>
<td>
<i></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
恭喜
</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

通过完成本练习，您已学会如何：
</font></font><br>
<ul>
  <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用HTTPCaller转换器在工作空间中使用FME Server REST API</font></font></li>
  <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个自定义转换器，持续检查FME Server以查看作业是否已完成</font></font></li>
  <li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用FME Server REST API连续运行多个作业</font></font></li>
</ul>

</td>
</tr>
</tbody></table>
<hr>
</article>
  </div>
