  <div id="readme" class="readme blob instapaper_body">
    <article class="markdown-body entry-content" itemprop="text"><h2><a id="user-content-chapter-5--web-services-direct-urls-and-the-rest-api" class="anchor" aria-hidden="true" href="./5.0.WebServicesAndRESTAPI.md#chapter-5--web-services-direct-urls-and-the-rest-api"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第5章 Web服务，直接URL和REST API</font></font></h2>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接URL看起来类似于REST API请求URL; </font><font style="vertical-align: inherit;">但是，它存在于REST API之外。</font><font style="vertical-align: inherit;">查找直接URL登录到服务器并找到工作空间的示例。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开高级选项卡并向下滚动，直到找到直接URL示例：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image5.0.1.Direct.png"><img src="./5.0.WebServicesAndRESTAPI_files/image5.0.1.Direct.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Direct URL的身份验证过程与REST API不同。</font><font style="vertical-align: inherit;">使用直接URL，您可以将一个令牌添加到URL的末尾，如下所示：</font></font></p>
<pre><code>http://&lt;yourServerHost&gt;/fmejobsubmitter/&lt;yourRepository&gt;/&lt;yourWorkspace&gt;?&lt;yourWorkpaceParameters&gt;/token=&lt;tokenValue&gt;
</code></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，直接URL将默认为guest用户帐户上设置的权限。</font><font style="vertical-align: inherit;">如果您的guest帐户无权在输入直接URL后运行工作空间，则可能会要求您登录。如果guest帐户具有权限，您可以在不登录的情况下运行直接URL。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单击该链接后，您的作业将运行，您将收到以下通知。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image5.0.2.JobSuccess.png"><img src="./5.0.WebServicesAndRESTAPI_files/image5.0.2.JobSuccess.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与REST API一样，Direct URL可以同步和异步地运行作业。</font><font style="vertical-align: inherit;">作业将自动同步运行。</font><font style="vertical-align: inherit;">要异步运行作业，请在“将结果发送到”的部分中输入电子邮件。</font><font style="vertical-align: inherit;">通过这样做，直接URL将自动更新为异步运行。</font><font style="vertical-align: inherit;">作业完成后，将发送一封电子邮件。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image5.0.3.directurlwithemail.png"><img src="./5.0.WebServicesAndRESTAPI_files/image5.0.3.directurlwithemail.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就像在REST API中一样，您可以在Direct URL中更改参数。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下表复制自以下关于数据下载服务的手册。</font><font style="vertical-align: inherit;">有关完整文档，请参阅</font></font><a href="https://docs.safe.com/fme/html/FME_Server_Documentation/Content/ReferenceManual/service_datadownload.htm?Highlight=direct%20url" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据下载服务</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档。</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接URL请求</font></font></strong> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font></font></strong></p>
<p></p><table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opt_responseformat</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xml或json
</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认值：xml</font></font></p>
</td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">响应的语言。</font><font style="vertical-align: inherit;">文本必须为小写</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opt_geturl</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据集的URL</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于转换的源数据集的URL</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opt_showresult</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对或错</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XML / JSON响应是否包含FME转换结果。</font><font style="vertical-align: inherit;">如果此参数不存在，则默认值为对。
</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opt_servicemode</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同步或异步或计划</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务的同步和异步模式之间切换。</font><font style="vertical-align: inherit;">异步提交作业（异步）时，会立即返回提交成功或失败的响应。</font><font style="vertical-align: inherit;">设置为同步（同步）时，在作业完成之前不会返回响应。
</font></font><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，安排数据下载请求在指定的开始时间运行（仅限一次）。</font><font style="vertical-align: inherit;">如果指定了计划，请参阅下面的其他参数。</font></font></p></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opt_requesteremail</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逗号分隔的电子邮件地址</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送通知电子邮件的地址。</font></font></td>
</tr>
</tbody></table>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接URL和REST API可以在应用程序中组合在一起，以利用两者的最佳组件。</font><font style="vertical-align: inherit;">一个例子是</font></font><a href="http://demos.fmeserver.com/easytranslator/index.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Easy Translator</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image5.0.4.EasyTranslator.png"><img src="./5.0.WebServicesAndRESTAPI_files/image5.0.4.EasyTranslator.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用REST API上传文件; </font><font style="vertical-align: inherit;">但是，作业是使用直接URL运行的。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是来自FME REST API JavaScript库的dataUpload函数的一部分代码。</font><font style="vertical-align: inherit;">请注意它不是完整的函数，但应该提供一些上下文来说明调用在JavaScript函数中的样子。</font></font></p>
<pre><code>dataUpload : function(repository, workspace, files, jsid, callback) {<font></font>
          var url = buildURL('{{svr}}/fmedataupload/' + repository + '/' + workspace);<font></font>
          var token = getConfig('token');<font></font>
          url = url + '?token=' + token;<font></font>
          ajax(url, callback, 'POST', params);<font></font>
</code></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用我们在REST API中看到的调用构建URL，然后将令牌添加到URL的末尾。</font><font style="vertical-align: inherit;">使用POST方法提交URL。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">幸运的是，这个调用以及FME Server REST API中的几乎所有调用都存在于REST API JavaScript库中，因此用户不必编写函数。</font><font style="vertical-align: inherit;">用户只需调用已创建的函数即可成功创建应用程序。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript函数中使用的直接URL如下所示：</font></font></p>
<pre><code>var submitUrl = BuildForm.host + '/fmedatadownload/' + BuildForm.repository + '/' +  BuildForm.workspaceName + '?SourceDataset_GENERIC=' + files;<font></font>
          submitUrl = submitUrl + '&amp;SourceFormat=' + sourceFormat;<font></font>
          submitUrl = submitUrl + '&amp;DestinationFormat=' + destFormat;<font></font>
          submitUrl = submitUrl + '&amp;COORDSYS_Dest=' + outputCoordSys + '&amp;opt_responseformat=json';<font></font>
</code></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，直接URL被构建，然后用户将单击DirectURL来激活它。</font></font></p>
</article>
  </div>
