  <div id="readme" class="readme blob instapaper_body">
    <article class="markdown-body entry-content" itemprop="text"><table>
<tbody><tr>
<td width="25%">
<i></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
练习13 
</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 创建工作空间以检索作业历史记录结果
</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总体目标</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 创建可以检索最后1000个作业并将其显示在HTML中的工作空间。 </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 如何在工作空间中使用“获取作业(Get Jobs)”调用 </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作空间</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C:\FMEData2018\Resources\RESTAPI\Chapter7Exercise13.Complete
</font></font></td>
</tr>
</tbody></table>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本练习中，我们将创建一个工作空间，用于从FME Server检索作业历史记录，并创建包含结果的HTML文件。</font><font style="vertical-align: inherit;">我们将创建的第一个工作空间从FME Server检索最新的1000个作业。</font><font style="vertical-align: inherit;">然后将结果格式化为包含结果的表格，在此表格下方将有一个图表，其中包含按日期显示的结果数量。</font></font></p>
<h4><a id="user-content-use-the-httpcaller-to-get-jobs-and-then-format-the-attributes" class="anchor" aria-hidden="true" href="./7.3.Exercise.md#use-the-httpcaller-to-get-jobs-and-then-format-the-attributes"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用HTTPCaller获取作业，然后格式化属性</font></font></h4>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.1.Step1.png"><img src="./Images/image7.3.1.Step1.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1）添加一个Creator</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在空白的FME工作空间中添加Creator转换器。</font><font style="vertical-align: inherit;">可以接受默认参数。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2）添加HTTPCaller</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加HTTPCaller并设置如下所示的参数：</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求URL：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> http：// &lt;yourServerHost&gt; / fmerest / v3 / transformations / jobs / completed
 </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP方法：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GET</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.2.HTTPParam.png"><img src="./Images/image7.3.2.HTTPParam.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选中使用身份验证旁边的复选框。</font><font style="vertical-align: inherit;">然后选择Basic作为身份验证模式，并使用Admin/Admin用户名和密码。</font><font style="vertical-align: inherit;">您还可以将身份验证方法设置为Web连接，然后使用在上一个练习中创建的FME Server连接。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.3.HTTPAuth.png"><img src="./Images/image7.3.3.HTTPAuth.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3）附加一个Inspector</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将Inspector附加到HTTPCaller。</font><font style="vertical-align: inherit;">然后运行工作空间。</font><font style="vertical-align: inherit;">工作空间运行后，将显示FME Data Inspector。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.4.HTTPResponse.png"><img src="./Images/image7.3.4.HTTPResponse.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们需要解析响应以将我们想要的信息转换为我们可以使用的属性。</font><font style="vertical-align: inherit;">在本练习中，我们将保留id，timeSubmitted和status。</font><font style="vertical-align: inherit;">我们希望在从FME Server返回的JSON中找到id，timeSubmitted和status。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4）删除Inspector</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们知道我们想要保留的属性并了解它们存储在从FME Server返回的JSON中的位置，我们可以删除Inspector。</font><font style="vertical-align: inherit;">选择Inspector并点击键盘上的删除按钮。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5）添加JSONFragmenter</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用JSONFragmenter将响应解析为所需的属性。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.5.JSONFrag.png"><img src="./Images/image7.3.5.JSONFrag.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON属性是从前一个调用生成的响应主体。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON查询应该以json开头，然后是存储属性的类别。</font><font style="vertical-align: inherit;">这可能首先需要一些试错。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于JSON查询，我们希望在项目类别中找到所有响应，因此，我们使用此语句json [“items”] [*]</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们需要在JSONFragmenter中设置Flattening Parameters。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.6.FlatParam.png"><img src="./Images/image7.3.6.FlatParam.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，我们输入我们希望保留的查询属性。</font><font style="vertical-align: inherit;">您应该保留id，timeSubmitted和status。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6）添加一个Attribute Keeper</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，添加AttributeKeeper。</font><font style="vertical-align: inherit;">将AttributeKeeper附加到JSONFragmenter。</font><font style="vertical-align: inherit;">在参数和要保留的属性下：写入timeSubmitted，id，status。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.7.AttKeep.png"><img src="./Images/image7.3.7.AttKeep.png" alt="" style="max-width:100%;"></a></p>
<hr>
<h4><a id="user-content-format-dates" class="anchor" aria-hidden="true" href="./7.3.Exercise.md#format-dates"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式日期</font></font></h4>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.8.Step2.png"><img src="./Images/image7.3.8.Step2.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7）添加DateTimeConverter</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加DateTimeConverter并将其附加到AttributeKeeper。</font><font style="vertical-align: inherit;">使用DateTimeConverter将日期格式化为％Y-％m-％d格式。</font><font style="vertical-align: inherit;">从FME Server返回的日期时间格式可能难以阅读。</font><font style="vertical-align: inherit;">通过修改输出格式，我们可以使我们的图表更具视觉吸引力。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数应填写如下：</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期时间属性：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> timeSubmitted
 </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入格式：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动检测FME和ISO格式
 </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出格式：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％Y-％m-％d
 </font></font><br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修复溢出：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.9.DateTime.png"><img src="./Images/image7.3.9.DateTime.png" alt="" style="max-width:100%;"></a></p>
<hr>
<h4><a id="user-content-create-a-table-with-the-job-history-results" class="anchor" aria-hidden="true" href="./7.3.Exercise.md#create-a-table-with-the-job-history-results"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用作业历史记录结果创建表格</font></font></h4>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.10.Step3.png"><img src="./Images/image7.3.10.Step3.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们用当前的结果编译一个表，它将创建一个表。</font><font style="vertical-align: inherit;">但是，它没有顺序，所以我们使用Sorter转换器。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8）添加Sorter转换器</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sorter转换器将连接到DateTimeConverter。</font><font style="vertical-align: inherit;">在“排序依据”部分下，列出以下参数：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.11.Sorter.png"><img src="./Images/image7.3.11.Sorter.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9）添加HTMLReportGenerator</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在HTML报告生成器中，我们可以添加自定义的HTML或包含从FME Server获取的信息的表。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.12.HTMLReportGen.png"><img src="./Images/image7.3.12.HTMLReportGen.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10）将自定义HTML添加到HTMLReportGenerator</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们要添加自定义HTML以指定HTML文件中的头域。</font></font></p>
<pre><code>&lt;h2&gt;&lt;strong&gt;Monthly Server Report&lt;/strong&gt;&lt;/h2&gt;
</code></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您有一个简介或任何格式化要求，您也可以将它放在这里。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11）将表添加到HTMLReportGenerator</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，在页面内容下，添加一个表。</font><font style="vertical-align: inherit;">指定表将使用的列内容和标题。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.13.HTMLTableParam.png"><img src="./Images/image7.3.13.HTMLTableParam.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要在创建表之前查看该表，请单击“在浏览器中预览”按钮。</font></font></p>
<hr>
<h4><a id="user-content-create-a-bar-chart-with-jobs-by-date" class="anchor" aria-hidden="true" href="./7.3.Exercise.md#create-a-bar-chart-with-jobs-by-date"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用”按日期的作业“创建条形图</font></font></h4>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.14.Step4.png"><img src="./Images/image7.3.14.Step4.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12）添加Aggregator转换器</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加Aggregator转换器并将其附加到DateTimeConverter。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.15.AggSetUP.png"><img src="./Images/image7.3.15.AggSetUP.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们需要按日期汇总所有作业以创建条形图，因此我们需要Aggregator。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.16.Aggregator.png"><img src="./Images/image7.3.16.Aggregator.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，我们按timeSubmitted对结果进行分组，timeSubmitted是提交属性的日期。</font><font style="vertical-align: inherit;">然后在Count Attribute下，我们创建一个名为DateCount的新属性。
</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确保“聚合模式(Accumulation Mode)”设置为“合并传入属性(Merge Incoming Attributes)”</font></font></strong></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13）附加HTMLReportGenerator</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们附加另一个HTMLReportGenerator。</font><font style="vertical-align: inherit;">参数设置如下：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.17.png"><img src="./Images/image7.3.17.png" alt="" style="max-width:100%;"></a></p>
<hr>
<h4><a id="user-content-format-the-layout-and-write-to-html" class="anchor" aria-hidden="true" href="./7.3.Exercise.md#format-the-layout-and-write-to-html"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式化布局并写入HTML</font></font></h4>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.18.Step5.png"><img src="./Images/image7.3.18.Step5.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14）添加HTMLLayouter</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将HTMLReportGenerators连接到HTMLLayouter。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.19.HTMLLayouter.png"><img src="./Images/image7.3.19.HTMLLayouter.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15）添加HTML写模块</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，添加一个HTML写模块。</font><font style="vertical-align: inherit;">可以接受默认值。</font><font style="vertical-align: inherit;">将文件保存到：</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\FMEData2018\Resources\Output\Training\JobHistory.html
</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16）查看结果！</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行工作空间并查看结果。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/image7.3.20.Results.png"><img src="./Images/image7.3.20.Results.png" alt="" style="max-width:100%;"></a></p>
<hr>

<table>
<tbody><tr>
<td>
<i></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
恭喜
</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

通过完成本练习，您已学会如何：
</font></font><br>
<ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用工作空间调用FME Server REST API以检索作业</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看FME Server的响应 </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用HTMLReportGenerator创建结果报告 </font></font></li>

</ul></td>
</tr>
</tbody></table>
</article>
  </div>
