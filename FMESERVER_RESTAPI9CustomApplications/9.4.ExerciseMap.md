  <div id="readme" class="readme blob instapaper_body">
    <article class="markdown-body entry-content" itemprop="text"><table>
<tbody><tr>
<td width="25%">
<i></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
练习16
</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 使用Esri Maps进行数据可视化 
</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总体目标</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 演示如何将工作空间集成到Web应用程序中，并允许用户根据他们在地图上的选择来设置工作空间中的参数。  </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esri Maps集成，DriveBC API，数据流和数据可视化。 </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成的HTML </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\FMEData2018\Resources\RESTAPI\mySecondApp\www\index.html
在  </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成JavaScript </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\FMEData2018\Resources\RESTAPI\mySecondApp\www\arcgismap.js
  </font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成的工作区 </font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\FMEData2018\Resources\RESTAPI\mySecondApp\fme\webapp.bcroads.fmw
 </font></font></td>
</tr>
</tbody></table>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本练习中，我们将创建一个允许用户选择区域的地图。</font><font style="vertical-align: inherit;">此选择将发送到工作空间。</font><font style="vertical-align: inherit;">在工作空间中，所选区域将剪切当前的事故。</font><font style="vertical-align: inherit;">系统会向用户发送带有Google地图的链接，其中包含所选区域内的事故。</font><font style="vertical-align: inherit;">本练习旨在演示如何在工作空间中使用其他API，如何将从用户选择的坐标引入工作空间，以及如何将数据流回用户。</font></font></p>

<table>
<tbody><tr>
<td>
<i></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
警告
</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

要使本练习正常工作，您需要完成 </font></font><a href="https://safe-software.gitbooks.io/fme-server-rest-api-training-2018/content/FMESERVER_RESTAPI8Session2/8.3.Exercise.SettingUp.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">练习14</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或使用现有的Web服务器进行测试。

</font></font></td>
</tr>
</tbody></table>
<h4><a id="user-content-set-up-the-html-file" class="anchor" aria-hidden="true" href="./9.4.ExerciseMap.md#set-up-the-html-file"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置HTML文件</font></font></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此应用程序分为几个不同的文档。</font><font style="vertical-align: inherit;">许多网站分别存储他们的JavaScript，CSS和HTML页面，以促进更清洁的工作流程。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1）创建index.html文档</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个HTML文件并将其另存为index.html。</font><font style="vertical-align: inherit;">将此文件保存在此处的mySecondApp文件夹中：C：\ FMEData2018 \ Resources \ RESTAPI \ mySecondApp。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2）复制并粘贴HTML文件的头部分</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将以下代码复制并粘贴到index.html文件中：</font></font></p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">&lt;</span>html<span class="pl-k">&gt;</span>

<span class="pl-k">&lt;</span>head<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>title<span class="pl-k">&gt;</span>ArcGIS Maps Example from <span class="pl-c1">FME</span> Server Developer Playground<span class="pl-k">&lt;</span><span class="pl-k">/</span>title<span class="pl-k">&gt;</span>
    <span class="pl-c"><span class="pl-c">&lt;!--</span></span> Styles <span class="pl-k">for</span> example <span class="pl-c"><span class="pl-c">--&gt;</span></span>
    <span class="pl-k">&lt;</span>link rel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>stylesheet<span class="pl-pds">"</span></span> href<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>https://playground.fmeserver.com/css/FMEServerExamples.css<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>text/css<span class="pl-pds">"</span></span> <span class="pl-k">/</span><span class="pl-k">&gt;</span>
    <span class="pl-c"><span class="pl-c">&lt;!--</span></span> Include <span class="pl-smi">FMEServer</span>.<span class="pl-smi">js</span> <span class="pl-c"><span class="pl-c">--&gt;</span></span>
    <span class="pl-k">&lt;</span>script type<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>text/javascript<span class="pl-pds">"</span></span> src<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>https://api.fmeserver.com/js/v1.2/FMEServer.js<span class="pl-pds">"</span></span><span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>script<span class="pl-k">&gt;</span>
    <span class="pl-c"><span class="pl-c">&lt;!--</span></span> The following are Required <span class="pl-k">for</span> ArcGIS Maps <span class="pl-c"><span class="pl-c">--&gt;</span></span>
    <span class="pl-k">&lt;</span>link rel<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>stylesheet<span class="pl-pds">"</span></span> href<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>https://js.arcgis.com/3.8/js/esri/css/esri.css<span class="pl-pds">"</span></span> <span class="pl-k">/</span><span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>script type<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>text/javascript<span class="pl-pds">"</span></span> src<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>https://js.arcgis.com/3.8/<span class="pl-pds">"</span></span><span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>script<span class="pl-k">&gt;</span>
    <span class="pl-c"><span class="pl-c">&lt;!--</span></span> Connects to our JavaScript file <span class="pl-c"><span class="pl-c">--&gt;</span></span>
    <span class="pl-k">&lt;</span>script type<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>text/javascript<span class="pl-pds">"</span></span> src<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>arcgismap.js<span class="pl-pds">"</span></span><span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>script<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span><span class="pl-k">/</span>head<span class="pl-k">&gt;</span>
<span class="pl-c"><span class="pl-c">&lt;!--</span></span><span class="pl-c1">PLACE</span> <span class="pl-c1">FUTURE</span> <span class="pl-c1">CODE</span> <span class="pl-c1">HERE</span><span class="pl-c"><span class="pl-c">--&gt;</span></span>

<span class="pl-k">&lt;</span><span class="pl-k">/</span>html<span class="pl-k">&gt;</span></pre></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个头部看起来非常类似于上一个练习中的部分。</font><font style="vertical-align: inherit;">不同之处在于还有一些额外的代码行：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.2.1.Esri.png"><img src="./Images/10.2.1.Esri.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们需要这段代码将Esri CSS链接到我们的代码。</font><font style="vertical-align: inherit;">Esri CSS将样式组件添加到地图中。</font><font style="vertical-align: inherit;">然后JavaScript链接到Esri制作的JavaScript库。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还添加了这行代码：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.2.2.png"><img src="./Images/10.2.2.png" alt="" style="max-width:100%;"></a></p>
<p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将编写一个JavaScript文件来使我们的HTML动态化。</font><font style="vertical-align: inherit;">最好将JavaScript与HTML分开，以确保每个文件尽可能干净且易于使用。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3）将主体复制并粘贴到索引文件中</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将主体粘贴到index.html文件中。</font><font style="vertical-align: inherit;">此部分属于这里以后的代码注释：</font></font></p>
<div class="highlight highlight-source-js"><pre><span class="pl-c"><span class="pl-c">&lt;!--</span></span> <span class="pl-c1">PLACE</span> <span class="pl-c1">FUTURE</span> <span class="pl-c1">CODE</span> <span class="pl-c1">HERE</span><span class="pl-c"><span class="pl-c">--&gt;</span></span>

<span class="pl-k">&lt;</span>body<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>h4<span class="pl-k">&gt;</span>This example clips an area selected by the user to <span class="pl-c1">BC</span> Traffic Data.<span class="pl-k">&lt;</span><span class="pl-k">/</span>h4<span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span>form id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>exampleForm<span class="pl-pds">"</span></span><span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>label<span class="pl-k">&gt;&lt;</span>b<span class="pl-k">&gt;</span>Step <span class="pl-c1">1</span><span class="pl-k">&lt;</span><span class="pl-k">/</span>b<span class="pl-k">&gt;</span> <span class="pl-k">-</span> Draw the Polygon<span class="pl-k">:</span> <span class="pl-k">&lt;</span><span class="pl-k">/</span>label<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>input id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>draw<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>button<span class="pl-pds">"</span></span> value<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Draw<span class="pl-pds">"</span></span> <span class="pl-k">/</span><span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>input id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>reset<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>button<span class="pl-pds">"</span></span> value<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Reset<span class="pl-pds">"</span></span> <span class="pl-k">/</span><span class="pl-k">&gt;&lt;</span>br <span class="pl-k">/</span><span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>div id<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>mapDiv<span class="pl-pds">"</span></span><span class="pl-k">&gt;&lt;</span><span class="pl-k">/</span>div<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>label<span class="pl-k">&gt;&lt;</span>b<span class="pl-k">&gt;</span>Step <span class="pl-c1">2</span><span class="pl-k">&lt;</span><span class="pl-k">/</span>b<span class="pl-k">&gt;</span> <span class="pl-k">-</span> Submit the Request to <span class="pl-c1">FME</span> Server<span class="pl-k">:</span> <span class="pl-k">&lt;</span><span class="pl-k">/</span>label<span class="pl-k">&gt;</span>
        <span class="pl-k">&lt;</span>input type<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>button<span class="pl-pds">"</span></span> onclick<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>processClip();<span class="pl-pds">"</span></span> value<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Clip Data To Area<span class="pl-pds">"</span></span> <span class="pl-k">/</span><span class="pl-k">&gt;</span>
    <span class="pl-k">&lt;</span><span class="pl-k">/</span>form<span class="pl-k">&gt;</span>
<span class="pl-k">&lt;</span><span class="pl-k">/</span>body<span class="pl-k">&gt;</span></pre></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们有一个非常简单的标题来解释应用程序的目的。</font><font style="vertical-align: inherit;">然后我们创建一个表单，使用按钮激活JavaScript中的不同函数。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4）检查index.html文件的组件</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转到您的Web目录并导航到您创建文件的位置。</font><font style="vertical-align: inherit;">在页面上单击鼠标右键，然后选择“检查”。</font><font style="vertical-align: inherit;">你应该看到这个：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.1.file.png"><img src="./Images/10.1.1.file.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左侧是页面的外观，右侧是HTML文件。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当您将光标悬停在页面上时，它将在页面上选择不同的元素并突出显示它们存在的位置。</font><font style="vertical-align: inherit;">它还会显示我们可能遇到的任何错误。</font><font style="vertical-align: inherit;">我们目前有错误，因为我们没有初始化地图所需的代码。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了使这个页面有效，我们需要代码：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化地图</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绘制多边形</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重置多边形</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将请求提交给FME服务器</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在可以启动JavaScript来创建这些功能！</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5）创建一个新的JavaScript文件</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们可以创建一个新的JavaScript文件，标题为arcgismap.js并将其保存在与index.html相同的文件夹中。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6）添加代码以初始化地图</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将以下代码粘贴到我们刚刚创建的JavaScript文件中。</font><font style="vertical-align: inherit;">确保更改您的服务器和令牌。</font></font></p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> map, toolbar, clippingGeometry;<font></font>
<font></font>
   <span class="pl-c1">window</span>.<span class="pl-en">onload</span> <span class="pl-k">=</span> <span class="pl-k">function</span>()<font></font>
   {<font></font>
       <span class="pl-c1">require</span>([
           <span class="pl-s"><span class="pl-pds">"</span>esri/map<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>esri/toolbars/draw<span class="pl-pds">"</span></span>,
           <span class="pl-s"><span class="pl-pds">"</span>esri/graphic<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>esri/geometry/webMercatorUtils<span class="pl-pds">"</span></span>,
           <span class="pl-s"><span class="pl-pds">"</span>esri/symbols/SimpleLineSymbol<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>esri/symbols/SimpleFillSymbol<span class="pl-pds">"</span></span>,
           <span class="pl-s"><span class="pl-pds">"</span>dojo/_base/Color<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>dojo/dom<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>dojo/on<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>dojo/domReady!<span class="pl-pds">"</span></span>
       ], <span class="pl-k">function</span>(
           <span class="pl-c1">Map</span>, <span class="pl-smi">Draw</span>,
           <span class="pl-smi">Graphic</span>, <span class="pl-smi">webMercatorUtils</span>,
           <span class="pl-smi">SimpleLineSymbol</span>, <span class="pl-smi">SimpleFillSymbol</span>,
           <span class="pl-smi">Color</span>, <span class="pl-smi">dom</span>, <span class="pl-smi">on</span><font></font>
       )<font></font>
       {<font></font>
           map <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Map</span>(<span class="pl-s"><span class="pl-pds">"</span>mapDiv<span class="pl-pds">"</span></span>,<font></font>
           {<font></font>
               basemap<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>streets<span class="pl-pds">"</span></span>,<font></font>
               center<span class="pl-k">:</span> [<span class="pl-k">-</span><span class="pl-c1">123.114166</span>, <span class="pl-c1">49.27</span>],<font></font>
               zoom<span class="pl-k">:</span> <span class="pl-c1">7</span>,<font></font>
               minZoom<span class="pl-k">:</span> <span class="pl-c1">4</span>,<font></font>
               smartNavigation<span class="pl-k">:</span> <span class="pl-c1">false</span><font></font>
           });<font></font>
<font></font>
           <span class="pl-smi">map</span>.<span class="pl-en">on</span>(<span class="pl-s"><span class="pl-pds">"</span>load<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>()<font></font>
           {<font></font>
               toolbar <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Draw</span>(map);<font></font>
<font></font>
               <span class="pl-smi">dojo</span>.<span class="pl-en">connect</span>(toolbar, <span class="pl-s"><span class="pl-pds">"</span>onDrawEnd<span class="pl-pds">"</span></span>, addToMap);<font></font>
<font></font>
               <span class="pl-en">on</span>(<span class="pl-smi">dom</span>.<span class="pl-en">byId</span>(<span class="pl-s"><span class="pl-pds">"</span>draw<span class="pl-pds">"</span></span>), <span class="pl-s"><span class="pl-pds">"</span>click<span class="pl-pds">"</span></span>, drawPolygon);
               <span class="pl-en">on</span>(<span class="pl-smi">dom</span>.<span class="pl-en">byId</span>(<span class="pl-s"><span class="pl-pds">"</span>reset<span class="pl-pds">"</span></span>), <span class="pl-s"><span class="pl-pds">"</span>click<span class="pl-pds">"</span></span>, drawReset);<font></font>
           });<font></font>
<font></font>
           <span class="pl-k">function</span> <span class="pl-en">addToMap</span>(<span class="pl-smi">geometry</span>)<font></font>
           {<font></font>
               <span class="pl-k">var</span> symbol <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">SimpleFillSymbol</span>(
                   <span class="pl-smi">SimpleFillSymbol</span>.<span class="pl-c1">STYLE_SOLID</span>,
                   <span class="pl-k">new</span> <span class="pl-en">SimpleLineSymbol</span>(
                       <span class="pl-smi">SimpleLineSymbol</span>.<span class="pl-c1">STYLE_DASHDOT</span>,
                       <span class="pl-k">new</span> <span class="pl-en">Color</span>([<span class="pl-c1">255</span>, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>]), <span class="pl-c1">2</span><font></font>
                   ),<font></font>
                   <span class="pl-k">new</span> <span class="pl-en">Color</span>([<span class="pl-c1">255</span>, <span class="pl-c1">255</span>, <span class="pl-c1">0</span>, <span class="pl-c1">0.25</span>])<font></font>
               );<font></font>
               geometry <span class="pl-k">=</span> <span class="pl-smi">webMercatorUtils</span>.<span class="pl-en">webMercatorToGeographic</span>(geometry);
               <span class="pl-k">var</span> graphic <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Graphic</span>(geometry, symbol);
               <span class="pl-smi">map</span>.<span class="pl-smi">graphics</span>.<span class="pl-c1">clear</span>();
               <span class="pl-smi">map</span>.<span class="pl-smi">graphics</span>.<span class="pl-c1">add</span>(graphic);
               <span class="pl-smi">toolbar</span>.<span class="pl-en">deactivate</span>(<span class="pl-smi">Draw</span>.<span class="pl-c1">POLYGON</span>);<font></font>
               clippingGeometry <span class="pl-k">=</span> <span class="pl-smi">geometry</span>.<span class="pl-smi">rings</span>[<span class="pl-c1">0</span>];<font></font>
           }<font></font>
<font></font>
           <span class="pl-k">function</span> <span class="pl-en">drawPolygon</span>()<font></font>
           {<font></font>
               <span class="pl-en">drawReset</span>();
               <span class="pl-smi">toolbar</span>.<span class="pl-en">activate</span>(<span class="pl-smi">esri</span>.<span class="pl-smi">toolbars</span>.<span class="pl-smi">Draw</span>.<span class="pl-c1">POLYGON</span>);<font></font>
           }<font></font>
<font></font>
           <span class="pl-k">function</span> <span class="pl-en">drawReset</span>()<font></font>
           {<font></font>
               <span class="pl-smi">toolbar</span>.<span class="pl-en">deactivate</span>(<span class="pl-smi">esri</span>.<span class="pl-smi">toolbars</span>.<span class="pl-smi">Draw</span>.<span class="pl-c1">POLYGON</span>);
               <span class="pl-smi">map</span>.<span class="pl-smi">graphics</span>.<span class="pl-c1">clear</span>();<font></font>
           }<font></font>
       });<font></font>
       <span class="pl-smi">FMEServer</span>.<span class="pl-en">init</span>(<font></font>
       {<font></font>
           server<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>https://demos-safe-software.fmecloud.com<span class="pl-pds">"</span></span>, <span class="pl-c"><span class="pl-c">//</span>Update to your FME Server hostname - on FME training machines this is http://fmetraining</span>
           token<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>568c604bc1f235bbe137c514e7c61a8436043070<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">//</span>Update to your fmetoken</span><font></font>
       });<font></font>
   };</pre></div>
<br>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7）刷新index.html页面并测试它</font></font></strong></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.2.mapin.png"><img src="./Images/10.1.2.mapin.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此代码使用Esri JavaScript API在页面上显示地图并激活绘图和重置功能。</font><font style="vertical-align: inherit;">如果您在其他应用程序中使用此代码，则大部分代码都可以保持不变。</font><font style="vertical-align: inherit;">但是，您可能希望更新下面显示的地图设置：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.2.3.map.png"><img src="./Images/10.2.3.map.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，您可以调整地图的中心（地图所在的位置），缩放和最小缩放。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，您可以更改存储用户指定的几何图形的变量。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.2.4.clippinggeo.png"><img src="./Images/10.2.4.clippinggeo.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里我们说明第一个几何环将在剪切几何。如果您愿意，我们可以用这行代码向用户显示坐标:</font></font></p>
<div class="highlight highlight-source-js"><pre>    <span class="pl-en">alert</span>(<span class="pl-c1">JSON</span>.<span class="pl-c1">stringify</span>(clippingGeometry));</pre></div>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8）将以下函数添加到JavaScript文件中。</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们插入的第一个函数下面，我们需要再插入两个。</font><font style="vertical-align: inherit;">这些函数运行数据下载服务并显示FME Server返回的结果。</font></font></p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">function</span> <span class="pl-en">showResults</span>(<span class="pl-smi">json</span>)<font></font>
{<font></font>
    <span class="pl-c"><span class="pl-c">//</span> The following is to write out the full return object</span>
    <span class="pl-c"><span class="pl-c">//</span> for visualization of the example</span>
    <span class="pl-k">var</span> hr <span class="pl-k">=</span> <span class="pl-c1">document</span>.<span class="pl-c1">createElement</span>(<span class="pl-s"><span class="pl-pds">"</span>hr<span class="pl-pds">"</span></span>);
    <span class="pl-k">var</span> div <span class="pl-k">=</span> <span class="pl-c1">document</span>.<span class="pl-c1">createElement</span>(<span class="pl-s"><span class="pl-pds">"</span>div<span class="pl-pds">"</span></span>);<font></font>
<font></font>
    <span class="pl-c"><span class="pl-c">//</span> This extracts the download link to the clipped data</span>
    <span class="pl-k">var</span> download <span class="pl-k">=</span> <span class="pl-smi">json</span>.<span class="pl-smi">serviceResponse</span>.<span class="pl-smi">url</span>;<font></font>
<font></font>
<font></font>
    <span class="pl-smi">div</span>.<span class="pl-smi">innerHTML</span> <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">"</span>&lt;hr&gt;&lt;a href=<span class="pl-cce">\"</span><span class="pl-pds">"</span></span> <span class="pl-k">+</span> download <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span><span class="pl-cce">\"</span>&gt;Download Result&lt;/a&gt;<span class="pl-pds">"</span></span>;
    <span class="pl-c1">document</span>.<span class="pl-c1">body</span>.<span class="pl-c1">appendChild</span>(hr);
    <span class="pl-c1">document</span>.<span class="pl-c1">body</span>.<span class="pl-c1">appendChild</span>(div);<font></font>
}<font></font>
<font></font>
<span class="pl-k">function</span> <span class="pl-en">processClip</span>()<font></font>
{<font></font>
    <span class="pl-k">var</span> repository <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>RESTTraining<span class="pl-pds">"</span></span>;
    <span class="pl-k">var</span> workspace <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>webapp.bcroads.fmw<span class="pl-pds">"</span></span>;<font></font>
<font></font>
    <span class="pl-c"><span class="pl-c">//</span> Process the clippingGeometry into a WKT Polygon string</span>
    <span class="pl-k">var</span> geometry <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>POLYGON((<span class="pl-pds">"</span></span>;<font></font>
<font></font>
    <span class="pl-k">for</span> (<span class="pl-k">var</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> <span class="pl-smi">clippingGeometry</span>.<span class="pl-c1">length</span>; i<span class="pl-k">++</span>)<font></font>
    {<font></font>
        <span class="pl-k">var</span> lat <span class="pl-k">=</span> clippingGeometry[i][<span class="pl-c1">1</span>];
        <span class="pl-k">var</span> lng <span class="pl-k">=</span> clippingGeometry[i][<span class="pl-c1">0</span>];<font></font>
        geometry <span class="pl-k">+=</span> lng <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span> <span class="pl-k">+</span> lat <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>,<span class="pl-pds">"</span></span>;<font></font>
    }<font></font>
<font></font>
    <span class="pl-c"><span class="pl-c">//</span> Remove trailing , from string</span>
    geometry <span class="pl-k">=</span> <span class="pl-smi">geometry</span>.<span class="pl-c1">substr</span>(<span class="pl-c1">0</span>, <span class="pl-smi">geometry</span>.<span class="pl-c1">length</span> <span class="pl-k">-</span> <span class="pl-c1">1</span>);<font></font>
    geometry <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">"</span>))<span class="pl-pds">"</span></span>;<font></font>
<font></font>
    <span class="pl-k">var</span> params <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>GEOM=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> geometry;<font></font>
<font></font>
    <span class="pl-c"><span class="pl-c">//</span> Use the FME Server Data Download Service</span>
    <span class="pl-smi">FMEServer</span>.<span class="pl-en">runDataDownload</span>(repository, workspace, params, showResults);<font></font>
}</pre></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们还没有将工作空间上传到我们的服务器，因此它们目前无法工作，但让我们讨论如何重新创建这些函数。</font><font style="vertical-align: inherit;">我们使用processClip函数的目标是使用runDataDownload函数。</font><font style="vertical-align: inherit;">在</font></font><a href="https://playground.fmeserver.com/javascript/data-delivery/arcgis-maps-integration/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ArcGIS的地图集成</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档可以在 FME Server Playground被找到。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.3.DataDownload.png"><img src="./Images/10.1.3.DataDownload.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用此函数，我们需要以下变量：</font></font></p>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作空间</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回调</font></font></li>
</ul>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用此函数，我们必须在代码中包含此函数：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.2.5.DataDownload.png"><img src="./Images/10.2.5.DataDownload.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后我们可以开始指定变量，第一个也是最简单的是存储库和工作空间。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.2.6.workspace.png"><img src="./Images/10.2.6.workspace.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们可以创建参数变量。</font><font style="vertical-align: inherit;">通过工作空间，我们将创建我们需要知道所有高级参数，以便能够使用这个调用。</font><font style="vertical-align: inherit;">因此，如果您在实际情况下使用此调用，则最好先创建工作空间。</font><font style="vertical-align: inherit;">但是，工作空间中唯一的参数是GEOM，它将接受来自我们应用程序的Well Known Text（WKT）。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well Known Text是一种格式，可以创建如下所示的字符串：</font></font></p>
<pre><code>POLYGON((-123.31968482260129 49.05758039932133,-123.64927466635129 50.269944861577876,-119.33714087728879 50.34712582770931))
</code></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在JavaScript中，我们可以将一些字符串添加到一起以创建完整参数，例如我们可以创建一个函数：</font></font></p>
<div class="highlight highlight-source-js"><pre>    a<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>app<span class="pl-pds">"</span></span>;
    b<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>le<span class="pl-pds">"</span></span>;
    apple<span class="pl-k">=</span> a<span class="pl-k">+</span>b;</pre></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apple将​​等于字符串“apple”。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这也可以通过以下语句完成：</font></font></p>
<<div class="highlight highlight-source-js"><pre>    a<span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>The REST API is <span class="pl-pds">"</span></span>;
    a <span class="pl-k">+=</span> <span class="pl-s"><span class="pl-pds">"</span>fun<span class="pl-pds">"</span></span>;</pre></div>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a将等于“The REST API is fun”。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用此方法来创建此调用运行所需的参数字符串。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们从声明输入将是Polygon（多边形）开始。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.2.7.geometry.png"><img src="./Images/10.2.7.geometry.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们需要输入用户选择的坐标。</font><font style="vertical-align: inherit;">在程序的早期，我们指定clippingGeometry将包含用户选择的几何图形。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们需要一个函数来对clippingGeometry变量中的所有数据进行排序。</font><font style="vertical-align: inherit;">为此，我们将使用for循环。</font><font style="vertical-align: inherit;">当没有剩余数据时，此循环将结束。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.2.8.clippingloop.png"><img src="./Images/10.2.8.clippingloop.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要的是要注意JavaScript中数组中元素的索引从0开始而不是1，lng(经度），我们分配第一个坐标读取，然后lat（纬度）位于第二个位置。</font><font style="vertical-align: inherit;">然后通过以下语句添加几何字符串：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.2.9.addinggeom.png"><img src="./Images/10.2.9.addinggeom.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将给我们留下以下声明：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.4.incompletestring.png"><img src="./Images/10.1.4.incompletestring.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要完成几何字符串，我们需要删除结尾的逗号并关闭括号。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.2.10.shortenstring.png"><img src="./Images/10.2.10.shortenstring.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在已经为参数创建了语句。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您创建的每个参数都将具有与之关联的名称。</font><font style="vertical-align: inherit;">在我们的例子中，我们的参数名称将是GEOM。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.2.11.params.png"><img src="./Images/10.2.11.params.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，我们已经完成了运行DataDownload函数所需的参数。</font><font style="vertical-align: inherit;">我们只需要一个函数来接受DataDownload函数生成的json，所以我们使用showResults函数。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次使用该文档，我们可以从FME Server查看JSON的外观：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.3.DataDownload.png"><img src="./Images/10.1.3.DataDownload.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要查找下载链接，我们使用以下语句：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.2.12.vardownload.png"><img src="./Images/10.2.12.vardownload.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这说明了URL下载链接的位置，它位于JSON内，serviceResponse里以及URL下面。</font><font style="vertical-align: inherit;">你可以在这里找到这个：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.5.URL.png"><img src="./Images/10.1.5.URL.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们有了URL，我们可以在这里的链接中显示URL：</font></font></p>
<pre><code>div.innerHTML += "&lt;hr&gt;&lt;a href=\""+download+"\"&gt;Download Result&lt;/a&gt;";
</code></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在有一个应用程序将接受用户选择的坐标，然后使用DataDownload服务返回该区域中的函数。</font><font style="vertical-align: inherit;">现在我们可以创建一个工作空间来使用。</font></font></p>
<h4><a id="user-content-create-a-workspace" class="anchor" aria-hidden="true" href="./9.4.ExerciseMap.md#create-a-workspace"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建工作空间</font></font></h4>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9）在FME Workbench中打开一个空白工作空间，并将Creator 转换器添加到工作空间</font></font></strong></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10）添加GeometryReplacer</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一步是从Web应用程序获取用户输入。</font><font style="vertical-align: inherit;">如果您查看代码的这一部分，您可以看到我们设置的代码是从用户输入接受一个well-known文本字符串并将其放在一个名为GEOM的参数中。</font></font></p>
<pre><code>var params = "GEOM=" + wktString;
</code></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，要将此信息引入工作空间，我们将使用GeometryReplacer。</font><font style="vertical-align: inherit;">在GeometryReplacer中填写以下参数：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.6.GeoReplace.png"><img src="./Images/10.1.6.GeoReplace.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几何编码是OGC Well Known Text。</font><font style="vertical-align: inherit;">几何源是将创建的用户参数。</font><font style="vertical-align: inherit;">在几何编码上单击下拉列表，找到用户参数，然后单击“创建用户参数”。</font></font></p>
<p>打开的对话框允许我们创建一个新的参数。使用以下参数创建一个：</p>
<p><strong>Name（名称）:</strong> GEOM</p>
<p><strong>Published（已发布）:</strong> Yes</p>
<p><strong>Optional（可选）:</strong> No</p>
<p><strong>Prompt（提示）:</strong> Area of Interest（感兴趣的区域）</p>
<p><strong>Default Value（默认值）:</strong> POLYGON((-123.31968482260129 49.05758039932133,-123.64927466635129 50.269944861577876,-119.33714087728879 50.34712582770931))</p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.7.GeomParam.png"><img src="./Images/10.1.7.GeomParam.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11）添加CoordinateSystemSetter</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在工作空间的这一点上，我们将坐标系统放入系统，并将其转换为几何要素。</font><font style="vertical-align: inherit;">但是，FME无法知道坐标系是什么。</font><font style="vertical-align: inherit;">所以我们将它设置为LL84。</font><font style="vertical-align: inherit;">将CoordinateSystemSetter连接到GeometryReplacer的Output端口。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.5.Workspace.png"><img src="./Images/10.1.5.Workspace.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12）添加HTTPCaller</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将HTTPCaller添加到画布并将其附加到Creator。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节中，我们使用的是Drive BC API。</font><font style="vertical-align: inherit;">Drive BC API检索最新的交通信息，并将其转发到您的地图。</font><font style="vertical-align: inherit;">如果您想了解更多信息，请访问</font></font><a href="https://catalogue.data.gov.bc.ca/dataset/open511-drivebc-api" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drive BC API网站</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们需要添加HTTPCaller以联系Drive BC API。</font><font style="vertical-align: inherit;">Drive BC API向公众开放，因此无需授权或身份验证。</font><font style="vertical-align: inherit;">在请求URL下：</font></font></p>
<pre><code>http://api.open511.gov.bc.ca/events?format=json&amp;status=ACTIVE
</code></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP方法是GET</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPCaller参数应如下所示：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.9.HTTPCaller.png"><img src="./Images/10.1.9.HTTPCaller.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13）使用要素缓存运行</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们将测试工作空间。</font><font style="vertical-align: inherit;">这将确保工作空间连接到DriveBC API。</font><font style="vertical-align: inherit;">这也将让我们检查API返回的内容。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，将工作空间保存为mySecondApp文件夹中的webapp.bcroads.fmw。</font><font style="vertical-align: inherit;">要使用要素缓存，请单击工具栏中的“运行”。</font><font style="vertical-align: inherit;">然后单击使用要素缓存运行。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，选择play按钮来运行。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单击HTTPCaller上的放大镜，检查REST API的输出。</font><font style="vertical-align: inherit;">API返回的JSON存储在response_body中。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.9.Feature.png"><img src="./Images/10.1.9.Feature.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在response_body中，您应该看到的结构应该与下面的结构相似。</font></font></p>
<pre><code>  {<font></font>
    "events": [<font></font>
        {<font></font>
            "jurisdiction_url": "http://api.open511.gov.bc.ca/jurisdiction",<font></font>
            "url": "http://api.open511.gov.bc.ca/events/drivebc.ca/DBC-1301",<font></font>
            "id": "drivebc.ca/DBC-1301",<font></font>
            "headline": "CONSTRUCTION",<font></font>
            "status": "ACTIVE",<font></font>
            "created": "2018-09-04T13:18:13-07:00",<font></font>
            "updated": "2018-09-04T13:18:13-07:00",<font></font>
            "description": "Highway 1, westbound. Paving operations planned between Exit 146 and Exit 135: Highway 9 for 11.0 km (Chilliwack). Starting today at 9:00 PM PDT until tomorrow at about 6:30 AM PDT. 28 km west of Hope between Herrling Island and Hwy 9. Last updated today at 1:18 PM PDT. (DBC-1301)",<font></font>
            "+ivr_message": "Highway 1, westbound. Paving operations planned between Exit 146 and Exit 135: Highway 9 for 11.0 km (Chilliwack). Starting Tuesday, September 4 at 9:00 PM until tomorrow at about 6:30 AM. Last updated Tuesday, September 4 at 1:18 PM.",<font></font>
            "schedule": {<font></font>
    "intervals": [<font></font>
        "2018-09-05T04:00/2018-09-05T13:30"<font></font>
    ]<font></font>
},<font></font>
            "event_type": "CONSTRUCTION",<font></font>
            "event_subtypes": [<font></font>
                "ROAD_MAINTENANCE"<font></font>
            ],<font></font>
            "severity": "MINOR",<font></font>
            "geography": {<font></font>
                "type": "LineString",<font></font>
                "coordinates": [                    <font></font>
                    [<font></font>
                        -121.760359,<font></font>
                        49.181117<font></font>
                    ],  <font></font>
</code></pre>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14）添加JSONFragmenter</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在画布上添加JSONFragmenter并将其附加到HTTPCaller。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">响应主体将以JSON的长段形式返回。</font><font style="vertical-align: inherit;">我们需要将其分解并暴露所需的属性。</font><font style="vertical-align: inherit;">此JSONFragmenter将用于暴露在上面的代码中"events"下列出的属性。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Source下填写参数：</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入源：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> JSON属性</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON属性：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> response_body</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来转到参数部分。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有重要信息都存储在"事件"类别中，以便在如下的JSON查询下能够访问它：</font></font></p>
<pre><code>json["events"][*]
</code></pre>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">片段格式：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> JSON</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拒绝不产生片段的要素：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.11.JSONFra.png"><img src="./Images/10.1.11.JSONFra.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们可以对JSON进行展平来生成表所需的属性。</font></font></p>
<p><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在“要暴露的属性”部分中，写入以下属性：状态，标题，说明，已创建和已更新。</font></font></em></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展平参数应如下所示：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.12.JSONF.png"><img src="./Images/10.1.12.JSONF.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15）添加另一个JSONFragmenter</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将另一个JSONFragmenter添加到画布并将其附加到以前的JSONFragmenter。</font><font style="vertical-align: inherit;">现在，我们需要暴露Geography组件来创建要素。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填写以下参数：</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入源：JSON属性</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON属性：response_body</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSON查询：json [“geography”]</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">片段格式：JSON</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拒绝不产生片段的要素：是的</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展平参数</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将查询结果展平为属性：否</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.13.NewJ.png"><img src="./Images/10.1.13.NewJ.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16）添加GeometryReplacer</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加GeometeryReplacer并将其附加到第二个JSONFragmenter。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GeometeryReplacer是一个神奇的变压器。</font><font style="vertical-align: inherit;">它可以从Response Body读取JSON，并自动创建与之关联的几何图形。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填写以下参数：</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几何编码：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GeoJSON</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几何来源：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> response_body</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除属性：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.14.GeoReplace.png"><img src="./Images/10.1.14.GeoReplace.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17）添加CoordinateSystemSetter</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加CoordinateSystemSetter并将其附加到GeometryReplacer。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们需要设置使用的坐标系。</font><font style="vertical-align: inherit;">坐标系在调用返回的URL中引用。</font><font style="vertical-align: inherit;">所以我们可以将它设置为LL-WGS84。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.15.SystemSet.png"><img src="./Images/10.1.15.SystemSet.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目前，工作空间应如下所示：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.16.Current.png"><img src="./Images/10.1.16.Current.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18）添加Clipper转换</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将Clipper Transformer添加到画布并接受当前默认值。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们将使用限幅器变换器来剪切选定区域。</font><font style="vertical-align: inherit;">限幅器是用户选择的区域，限幅器是BC Drive API的几何形状。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作空间应如下所示：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.17.Clipper.png"><img src="./Images/10.1.17.Clipper.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19）使用要素缓存运行</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们将测试工作空间。</font><font style="vertical-align: inherit;">这将确保工作空间正常工作并剪切正确的区域。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择播放按钮来运行。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单击clipper上“Inside”端口上的放大镜，查看所选区域。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将打开FME Data Inspector。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FME Data Inspector将显示创建的点和线。</font><font style="vertical-align: inherit;">要显示背景地图，请转到顶部菜单栏。</font><font style="vertical-align: inherit;">查找工具，选择FME选项。</font><font style="vertical-align: inherit;">这将打开FME选项窗口。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景格式应从None更改为Stamen Maps。</font><font style="vertical-align: inherit;">然后，选择参数...</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择，地形图列表。</font><font style="vertical-align: inherit;">选择确定。</font><font style="vertical-align: inherit;">然后，在FME选项窗口中选择确定。</font><font style="vertical-align: inherit;">这将激活背景地图。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有结果都应该在BC。</font><font style="vertical-align: inherit;">在探索返回的要素后，关闭 Data Inspector。</font><font style="vertical-align: inherit;">然后，返回FME Workbench。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20）添加NoFeaturesTester</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在FME Workbench中开始键入NoFeaturesTester并选择自定义转换器。</font><font style="vertical-align: inherit;">NoFeaturesTester应该附加到Clipper的Inside端口。</font><font style="vertical-align: inherit;">该转换将测试是否有输出。</font><font style="vertical-align: inherit;">如果没有输入，则表示所有要素都在外面或被拒绝。</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20）添加DateTimeConverter</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加DateTimeConverter并将其附加到NoFeaturesTester的OUTPUT端口。</font><font style="vertical-align: inherit;">DateTimeConverter用于更新时间和日期，因此对用户来说更具可读性。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填写以下参数：</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期时间属性：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已更新已创建</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入格式：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动检测FME和ISO格式</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出格式：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">％Y：％m：％d％H：％M：％S</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修复溢出：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.17.DateTimeConverter.png"><img src="./Images/10.1.17.DateTimeConverter.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21）添加HTMLReportGenerator</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加HTMLReportGenerator并将其附加到DateTimeConverter。</font><font style="vertical-align: inherit;">现在，我们已准备好创建包含以下信息的网页。</font><font style="vertical-align: inherit;">我们需要三个部分，标题，地图和表格。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在页面设置下，找到页面标题框。</font><font style="vertical-align: inherit;">页面标题应为Drive BC API。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，创建标题。</font><font style="vertical-align: inherit;">在页面内容下选择自定义HTML。</font><font style="vertical-align: inherit;">在内容设置下，复制并粘贴以下内容：</font></font></p>
<pre><code>&lt;h1&gt; Drive BC Road and Weather Conditions &lt;/h1&gt;
</code></pre>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.18.ht.png"><img src="./Images/10.1.18.ht.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将添加一个地图组件(Map Component)。</font><font style="vertical-align: inherit;">页面内容应为Map（Google）。</font><font style="vertical-align: inherit;">然后，内容设置应设置如下：</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签属性：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图层颜色：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 255,55,5</font></font></p>
<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API密钥：</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">   &lt;&lt;空白&gt;&gt;</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目前，我们不打算填写API密钥。</font><font style="vertical-align: inherit;">由于这是出于开发目的，这是可以的。</font><font style="vertical-align: inherit;">如果要在生产设置中使用它，则需要API密钥。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您希望获得API密钥，请访问此网站</font></font><a href="https://developers.google.com/maps/documentation/javascript/get-api-key#quick-guide-to-getting-a-key" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google API密钥</font></font></a></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.19.Map.png"><img src="./Images/10.1.19.Map.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，创建一个表,包含状态，已创建，已更新，描述和标题列。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.20.CustomTable.png"><img src="./Images/10.1.20.CustomTable.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22）添加另一个HTMLReportGenerator</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加另一个HTMLReportGenerator并将其附加到NoFeaturesTester的NOINPUT端口。</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在页面标题框中写入：</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drive BC API</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在页面内容下选择标题。</font><font style="vertical-align: inherit;">然后，在“内容设置”下写入：</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在你选择的区域没有发生事故。(There are no incidents in the area you selected.)</font></font></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23）添加HTML写模块</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，添加HTML写模块以写入您选择的文件。</font><font style="vertical-align: inherit;">将HTML写模块附加到HTMLReportGenerators。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.17.HTML.png"><img src="./Images/10.1.17.HTML.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完整工作空间应如下所示：</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.21.Final.png"><img src="./Images/10.1.21.Final.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24）保存并运行工作空间</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们可以保存并运行工作空间以确保一切正常。</font><font style="vertical-align: inherit;">由于我们没有API密钥，因此我们会收到一条消息，指出这仅用于开发目的。</font><font style="vertical-align: inherit;">如果我们添加了密钥，我们就会有一个更复杂的页面。</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.22.GoogleMaps.png"><img src="./Images/10.1.22.GoogleMaps.png" alt="" style="max-width:100%;"></a></p>
<p><br><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25）将工作空间上传到您的服务器。</font></font></strong></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将工作空间发布到FME Server。</font><font style="vertical-align: inherit;">上传到RESTTraining存储库并将工作空间保存为webapp.bcroads.fmw。</font><font style="vertical-align: inherit;">使用数据下载服务注册工作空间。</font></font></p>
<hr>
<h4><a id="user-content-test-the-application" class="anchor" aria-hidden="true" href="./9.4.ExerciseMap.md#test-the-application"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试应用程序</font></font></h4>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">步骤1.绘制区域（双击以关闭多边形）</font></font></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">步骤2.选择“剪切数据到区域( Clip Data to Area)”</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.22.step1and2.png"><img src="./Images/10.1.22.step1and2.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">步骤3.下载DataDownload</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.23.step3.png"><img src="./Images/10.1.23.step3.png" alt="" style="max-width:100%;"></a></p>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">步骤4.查看文件</font></font></p>
<p><a target="_blank" rel="noopener noreferrer" href="./Images/10.1.24.step4.png"><img src="./Images/10.1.24.step4.png" alt="" style="max-width:100%;"></a></p>
<hr>

<table>
<tbody><tr>
<td>
<i></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
恭喜
</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">

通过完成本练习，您已学会如何：
</font></font><br>
<ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用ArcGIS地图将坐标发送到工作空间</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在工作空间使用中在线资源的坐标</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用FME Server JavaScript API中的DataDownload函数</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在工作空间中使用外部API</font></font></li>


</ul></td>
</tr>
</tbody></table>
</article>
  </div>
